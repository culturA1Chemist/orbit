<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Update DOM with Settings Form</title>
    <link rel="stylesheet" href="../dist/css/index.min.css" type="text/css" />
    <style>
      body {
        font-family: 'Lucida Sans', Verdana, sans-serif;
        padding: 40px;
      }
      .layout {
        display: grid;
        grid-template-columns: 3fr 1fr;

      }
      .fieldc {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr minmax(0px, 1fr);
        grid-column-gap: 15px;
      }
      #code {
       
        width: 100%;
        height: 400px;
        background: #000000;
        font-size:10px;
        appearance: none;
        border: none;
        resize: none;
        outline: none;
        overflow: hidden;
        font: inherit;
        padding: 0 1px;
        margin: 0 -1px;
        contain: strict;
        color: aqua;
        user-select: text;
        white-space: pre !important;
      }
      
        .item, div[class^="ring-"] {
            transition: all 1s;
        }
        form {
          z-index: 20;
          float: right;
          width: 400px;
          padding: 10px;
          font-size: smaller;
        }
        select {
          width: 100%;
        }
        #rings-container, .ringf-container > fieldset, .item-container > fieldset {
            padding: 10px;
        }
        fieldset {
            border-radius: 7px;
            padding: 10px;
        }
    </style>
  </head>
  <body>
<div class="layout">
  <div class="z-container"></div>
  <div>
    <form>
      <fieldset>
        <legend>Rings</legend>
        <div id="rings-container">
          <div class="ringf-container">
            <fieldset>
              <legend>Ring 1</legend>
              <div class="fieldc">
                <div class="fieldt">
                  <label for="ring1-arc">Arc</label><br>
                  <input type="range" id="ring1-arc" name="ring1-arc" min="0" max="360" step="45" value="0">
                </div>
                <div class="fieldt">
                  <label for="ring1-offset">Offset</label><br>
                  <input type="range" id="ring1-offset" name="ring1-offset" min="0" max="360" step="45" value="0">
                </div>
                <div class="fieldt">
                  <label for="ring1-ccw">CCW </label>
                  <input type="checkbox" id="ring1-ccw" name="ring1-ccw">
                </div>
                <div class="fieldt">
                  <label for="ring1-visible">visible </label>
                  <input type="checkbox" id="ring1-visible" name="ring1-visible" checked>
                </div>
              </div>
                <button type="button" class="add-item-button" data-ring="1">Add Item</button>
                <div class="items-container" id="ring1-items-container"></div>
            </fieldset>
          </div>
        </div>
        <button type="button" id="add-ring-button">Add Ring</button>
      </fieldset>
    </form>
  </div>
  <textarea readonly name="" id="code">
     
  </textarea>

 
 
</div>

    <script>
      const form = document.querySelector('form');
      const ringsContainer = document.querySelector('#rings-container');
      const addRingButton = document.querySelector('#add-ring-button');
      const removeItemButtonHandler = (event) => {
        // remove form element before update to do the trick
        event.target.parentElement.parentElement.remove()
        updateDOM()
      }
      const removeRingButtonHandler = (event) => {
        // remove form element before update to do the trick
        event.target.parentElement.parentElement.remove()
        updateDOM()
      }
      const addItemButtonHandler = (event) => {
        const ringNumber = event.target.dataset.ring;
        const itemsContainer = document.querySelector(`#ring${ringNumber}-items-container`);
        const newItem = document.createElement('div');
        newItem.classList.add('item-container');
        newItem.innerHTML = `
          <fieldset>
            <legend>Item ${itemsContainer.children.length + 1}</legend>
            <div class="fieldc">
              <div class="fieldt">
                <label for="ring${ringNumber}-item${itemsContainer.children.length + 1}-size">Size</label><br>
                <select id="ring${ringNumber}-item${itemsContainer.children.length + 1}-size" name="ring${ringNumber}-item${itemsContainer.children.length + 1}-size">
                  <option value="xxs">XXS</option>
                  <option value="xs">XS</option>
                  <option value="s">S</option>
                  <option value="m" selected>M</option>
                  <option value="l">L</option>
                  <option value="xl">XL</option>
                  <option value="xxl">XXL</option>
                </select>
              </div>
              <div class="fieldt">
                <label for="ring${ringNumber}-item${itemsContainer.children.length + 1}-shape">Shape</label><br>
                <select id="ring${ringNumber}-item${itemsContainer.children.length + 1}-shape" name="ring${ringNumber}-item${itemsContainer.children.length + 1}-shape">
                    <option value="box">Box</option>
                    <option value="circle" selected>Circle</option>
                    <option value="rounded">Rounded</option>
                    <option value="bubble">Bubble</option>
                </select>
              </div>
              <div class="fieldt">
                <label for="ring${ringNumber}-item${itemsContainer.children.length + 1}-alignment">Alignment</label><br>
                <select id="ring${ringNumber}-item${itemsContainer.children.length + 1}-alignment" name="ring${ringNumber}-item${itemsContainer.children.length + 1}-alignment">
                    <option value="" selected>Center</option>
                    <option value="upper">Upper</option>
                    <option value="lower">Lower</option>
                </select>
              </div>
            <div class="fieldt">
              <label for="ring${ringNumber}-item${itemsContainer.children.length + 1}-stationary">Stationary </label>
              <input type="checkbox" id="ring${ringNumber}-item${itemsContainer.children.length + 1}-stationary" name="ring${ringNumber}-item${itemsContainer.children.length + 1}-stationary">
            </div>

          </div>
          <button type="button" class="remove-item-button">remove</button>
          </fieldset>
        `;
        itemsContainer.appendChild(newItem);
        const removeItemButton = newItem.querySelector('.remove-item-button');
        removeItemButton.addEventListener('click', removeItemButtonHandler);
        formChangeHandler()
      };
      const addRingButtonHandler = () => {
        const ringNumber = ringsContainer.children.length + 1;
        const newRingContainer = document.createElement('div');
        newRingContainer.classList.add('ringf-container');
        newRingContainer.innerHTML = `
          <fieldset>
            <legend>Ring ${ringNumber}</legend>
            <div class="fieldc">
                <div class="fieldt">
                  <label for="ring${ringNumber}-arc">Arc</label><br>
                  <input type="range" id="ring${ringNumber}-arc" name="ring${ringNumber}-arc" min="0" max="360" step="45" value="0">
                </div>
                <div class="fieldt">
                  <label for="ring${ringNumber}-offset">Offset</label><br>
                  <input type="range" id="ring${ringNumber}-offset" name="ring${ringNumber}-offset" min="0" max="360" step="45" value="0">
                </div>
                <div class="fieldt">
                  <label for="ring${ringNumber}-ccw">CCW </label>
                  <input type="checkbox" id="ring${ringNumber}-ccw" name="ring${ringNumber}-ccw">
                </div>
                <div class="fieldt">
                  <label for="ring${ringNumber}-visible">visible </label>
                  <input type="checkbox" id="ring${ringNumber}-visible" name="ring${ringNumber}-visible" checked>
                </div>
              </div>
            <button type="button" class="add-item-button" data-ring="${ringNumber}">Add Item</button>
            <div class="items-container" id="ring${ringNumber}-items-container"></div>
            <button type="button" class="remove-ring-button">remove</button>
          </fieldset>
        `;
        ringsContainer.appendChild(newRingContainer);
        const addItemButton = newRingContainer.querySelector('.add-item-button');
        addItemButton.addEventListener('click', addItemButtonHandler);
        const removeRingButton = newRingContainer.querySelector('.remove-ring-button');
        removeRingButton.addEventListener('click', removeRingButtonHandler);
        formChangeHandler()
      };
      const updateDOM = () => {
        const rings = document.querySelectorAll('.ringf-container');
        const html = Array.from(rings).map((ring) => {
          const ringNumber = ring.querySelector('legend').textContent.split(' ')[1];
          const ccw = ring.querySelector(`#ring${ringNumber}-ccw`).checked ? 'ccw' : '';
          const visible = ring.querySelector(`#ring${ringNumber}-visible`).checked ? '' : 'transparent';
          const arc = ring.querySelector(`#ring${ringNumber}-arc`).value;
          const offset = ring.querySelector(`#ring${ringNumber}-offset`).value;
          var iNumber = 0
          const items = Array.from(ring.querySelectorAll('.item-container')).map((item) => {
            const itemNumber = item.querySelector('legend').textContent.split(' ')[1];
            iNumber = iNumber + 1
            const size = item.querySelector(`#ring${ringNumber}-item${itemNumber}-size`).value;
            const alignment = item.querySelector(`#ring${ringNumber}-item${itemNumber}-alignment`).value;
            const shape = item.querySelector(`#ring${ringNumber}-item${itemNumber}-shape`).value;
            const stationary = item.querySelector(`#ring${ringNumber}-item${itemNumber}-stationary`).checked ? 'stationary' : '';
            return `<div class="item ${shape} ${size} ${alignment} ${stationary}">${itemNumber}</div>\n`;
          }).join('');
          return `
    <div class="ring-${ringNumber} items-${iNumber} ${arc ? `arc-${arc}` : ``} ${offset ? `offset-${offset}` : ``} ${ccw}  ${visible}">
      ${items}
    </div>
          `;
        }).join('');
        const ringsContainer = document.querySelector('.z-container');
        ringsContainer.innerHTML = html;
        document.querySelector('#code').innerHTML = html;
      }; 
      const formChangeHandler = () => {
        updateDOM();
      };
      form.addEventListener('change', formChangeHandler);
      addRingButton.addEventListener('click', addRingButtonHandler);
      const addItemButtons = document.querySelectorAll('.add-item-button');
      addItemButtons.forEach((addItemButton) => {
        addItemButton.addEventListener('click', addItemButtonHandler);
      });
      
      
</script>
