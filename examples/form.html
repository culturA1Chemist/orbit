<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Update DOM with Settings Form</title>
    <link rel="stylesheet" href="../assets/css/index.min.css" type="text/css" />
    <style>
      body {
        font-family: 'Lucida Sans', Verdana, sans-serif;
        padding: 40px;
      }
      .layout {
        display: grid;
        grid-template-columns: 3fr 1fr;

      }
      .fieldc {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr minmax(0px, 1fr);
        grid-column-gap: 15px;
      }
      #code {
       
        width: 100%;
        height: 400px;
        background: #000000;
        font-size:10px;
        appearance: none;
        border: none;
        resize: none;
        outline: none;
        overflow: hidden;
        font: inherit;
        padding: 0 1px;
        margin: 0 -1px;
        contain: strict;
        color: aqua;
        user-select: text;
        white-space: pre !important;
      }
      
        .orbiter, div[class^="orbit-"] {
            transition: all 1s;
        }
        form {
          z-index: 20;
          float: right;
          width: 400px;
          padding: 10px;
          font-size: smaller;
        }
        select {
          width: 100%;
        }
        #orbits-container, .orbitf-container > fieldset, .orbiter-container > fieldset {
            padding: 10px;
        }
        fieldset {
            border-radius: 7px;
            padding: 10px;
        }
    </style>
  </head>
  <body>
<div class="layout">
  <div class="docker"></div>
  <div>
    <form>
      <fieldset>
        <legend>orbits</legend>
        <div id="orbits-container">
          <div class="orbitf-container">
            <div class="fieldc">
              <div class="fieldt">
                <label for="orbits-radius">Radius</label><br>
                <input type="range" id="orbits-radius" name="orbits-radius" min="0" max="1000" step="1" value="">
              </div>
            </div>
            <fieldset>
              <legend>orbit 1</legend>
              <div class="fieldc">
                <div class="fieldt">
                  <label for="orbit1-radius">Radius</label><br>
                  <input type="range" id="orbit1-radius" name="orbit1-radius" min="0" max="1000" step="1" value="">
                </div>
              </div>
              <div class="fieldc">
                <div class="fieldt">
                  <label for="orbit1-sector">sector</label><br>
                  <input type="range" id="orbit1-sector" name="orbit1-sector" min="0" max="360" step="45" value="0">
                </div>
                <div class="fieldt">
                  <label for="orbit1-offset">Offset</label><br>
                  <input type="range" id="orbit1-offset" name="orbit1-offset" min="0" max="360" step="45" value="0">
                </div>
                <div class="fieldt">
                  <label for="orbit1-ccw">CCW </label>
                  <input type="checkbox" id="orbit1-ccw" name="orbit1-ccw">
                </div>
                <div class="fieldt">
                  <label for="orbit1-visible">visible </label>
                  <input type="checkbox" id="orbit1-visible" name="orbit1-visible" checked>
                </div>
              </div>
                <button type="button" class="add-orbiter-button" data-orbit="1">Add orbiter</button>
                <div class="orbiters-container" id="orbit1-orbiters-container"></div>
            </fieldset>
          </div>
        </div>
        <button type="button" id="add-orbit-button">Add orbit</button>
      </fieldset>
    </form>
  </div>
  <textarea readonly name="" id="code">
     
  </textarea>

 
 
</div>

    <script>
      const form = document.querySelector('form');
      const radius = document.querySelector('#orbits-radius');
      const rradius = document.querySelector('#orbit1-radius');
      const zContainer = document.querySelector('.docker');
      const range = getComputedStyle(zContainer).getPropertyValue('--radius');
      radius.setAttribute('value', range.slice(0, -2).trim())
      rradius.setAttribute('value', range.slice(0, -2).trim())
      const orbitsContainer = document.querySelector('#orbits-container');
      const addorbitButton = document.querySelector('#add-orbit-button');
      const removeorbiterButtonHandler = (event) => {
        // remove form element before update to do the trick
        event.target.parentElement.parentElement.remove()
        updateDOM()
      }
      const removeorbitButtonHandler = (event) => {
        // remove form element before update to do the trick
        event.target.parentElement.parentElement.remove()
        updateDOM()
      }
      const addorbiterButtonHandler = (event) => {
        const orbitNumber = event.target.dataset.orbit;
        const orbitersContainer = document.querySelector(`#orbit${orbitNumber}-orbiters-container`);
        const neworbiter = document.createElement('div');
        neworbiter.classList.add('orbiter-container');
        neworbiter.innerHTML = `
          <fieldset>
            <legend>orbiter ${orbitersContainer.children.length + 1}</legend>
            <div class="fieldc">
              <div class="fieldt">
                <label for="orbit${orbitNumber}-orbiter${orbitersContainer.children.length + 1}-size">Size</label><br>
                <select id="orbit${orbitNumber}-orbiter${orbitersContainer.children.length + 1}-size" name="orbit${orbitNumber}-orbiter${orbitersContainer.children.length + 1}-size">
                  <option value="xxs">XXS</option>
                  <option value="xs">XS</option>
                  <option value="s">S</option>
                  <option value="m" selected>M</option>
                  <option value="l">L</option>
                  <option value="xl">XL</option>
                  <option value="xxl">XXL</option>
                </select>
              </div>
              <div class="fieldt">
                <label for="orbit${orbitNumber}-orbiter${orbitersContainer.children.length + 1}-shape">Shape</label><br>
                <select id="orbit${orbitNumber}-orbiter${orbitersContainer.children.length + 1}-shape" name="orbit${orbitNumber}-orbiter${orbitersContainer.children.length + 1}-shape">
                    <option value="box">Box</option>
                    <option value="circle" selected>Circle</option>
                    <option value="rounded">Rounded</option>
                    <option value="bubble">Bubble</option>
                </select>
              </div>
              <div class="fieldt">
                <label for="orbit${orbitNumber}-orbiter${orbitersContainer.children.length + 1}-alignment">Alignment</label><br>
                <select id="orbit${orbitNumber}-orbiter${orbitersContainer.children.length + 1}-alignment" name="orbit${orbitNumber}-orbiter${orbitersContainer.children.length + 1}-alignment">
                    <option value="" selected>Center</option>
                    <option value="upper">Upper</option>
                    <option value="lower">Lower</option>
                </select>
              </div>
            <div class="fieldt">
              <label for="orbit${orbitNumber}-orbiter${orbitersContainer.children.length + 1}-stationary">Stationary </label>
              <input type="checkbox" id="orbit${orbitNumber}-orbiter${orbitersContainer.children.length + 1}-stationary" name="orbit${orbitNumber}-orbiter${orbitersContainer.children.length + 1}-stationary">
            </div>

          </div>
          <button type="button" class="remove-orbiter-button">remove</button>
          </fieldset>
        `;
        orbitersContainer.appendChild(neworbiter);
        const removeorbiterButton = neworbiter.querySelector('.remove-orbiter-button');
        removeorbiterButton.addEventListener('click', removeorbiterButtonHandler);
        formChangeHandler()
      };
      const addorbitButtonHandler = () => {
        const orbitNumber = orbitsContainer.children.length + 1;
        const neworbitContainer = document.createElement('div');
        neworbitContainer.classList.add('orbitf-container');
        neworbitContainer.innerHTML = `
          <fieldset>
            <legend>orbit ${orbitNumber}</legend>
            <div class="fieldc">
              <div class="fieldt">
                <label for="orbit${orbitNumber}-radius">Radius</label><br>
                <input type="range" id="orbit${orbitNumber}-radius" name="orbit${orbitNumber}-radius" min="0" max="1000" step="1" value="">
              </div>
            </div>
            <div class="fieldc">
                
                <div class="fieldt">
                  <label for="orbit${orbitNumber}-sector">sector</label><br>
                  <input type="range" id="orbit${orbitNumber}-sector" name="orbit${orbitNumber}-sector" min="0" max="360" step="45" value="0">
                </div>
                <div class="fieldt">
                  <label for="orbit${orbitNumber}-offset">Offset</label><br>
                  <input type="range" id="orbit${orbitNumber}-offset" name="orbit${orbitNumber}-offset" min="0" max="360" step="45" value="0">
                </div>
                <div class="fieldt">
                  <label for="orbit${orbitNumber}-ccw">CCW </label>
                  <input type="checkbox" id="orbit${orbitNumber}-ccw" name="orbit${orbitNumber}-ccw">
                </div>
                <div class="fieldt">
                  <label for="orbit${orbitNumber}-visible">visible </label>
                  <input type="checkbox" id="orbit${orbitNumber}-visible" name="orbit${orbitNumber}-visible" checked>
                </div>
              </div>
            <button type="button" class="add-orbiter-button" data-orbit="${orbitNumber}">Add orbiter</button>
            <div class="orbiters-container" id="orbit${orbitNumber}-orbiters-container"></div>
            <button type="button" class="remove-orbit-button">remove</button>
          </fieldset>
        `;
        orbitsContainer.appendChild(neworbitContainer);
        document.querySelector(`#orbit${orbitNumber}-radius`).setAttribute('value', Number(range.slice(0, -2).trim()))
        const addorbiterButton = neworbitContainer.querySelector('.add-orbiter-button');
        addorbiterButton.addEventListener('click', addorbiterButtonHandler);
        const removeorbitButton = neworbitContainer.querySelector('.remove-orbit-button');
        removeorbitButton.addEventListener('click', removeorbitButtonHandler);
        formChangeHandler()
      };
      const updateDOM = () => {
        const orbits = document.querySelectorAll('.orbitf-container');
        const orbitsRadius = document.querySelector(`#orbits-radius`).value
        zContainer.style.setProperty('--radius', orbitsRadius + 'px');
        const html = Array.from(orbits).map((orbit) => {
          const orbitNumber = orbit.querySelector('legend').textContent.split(' ')[1];
          const ccw = orbit.querySelector(`#orbit${orbitNumber}-ccw`).checked ? 'ccw' : '';
          const visible = orbit.querySelector(`#orbit${orbitNumber}-visible`).checked ? '' : 'transparent';
          const sector = orbit.querySelector(`#orbit${orbitNumber}-sector`).value;
          const offset = orbit.querySelector(`#orbit${orbitNumber}-offset`).value;
          const orbitRadius = orbit.querySelector(`#orbit${orbitNumber}-radius`).value
          zContainer.style.setProperty(`--radius-${orbitNumber}`, orbitRadius + 'px');
          var iNumber = 0
          const orbiters = Array.from(orbit.querySelectorAll('.orbiter-container')).map((orbiter) => {
            const orbiterNumber = orbiter.querySelector('legend').textContent.split(' ')[1];
            iNumber = iNumber + 1
            const size = orbiter.querySelector(`#orbit${orbitNumber}-orbiter${orbiterNumber}-size`).value;
            const alignment = orbiter.querySelector(`#orbit${orbitNumber}-orbiter${orbiterNumber}-alignment`).value;
            const shape = orbiter.querySelector(`#orbit${orbitNumber}-orbiter${orbiterNumber}-shape`).value;
            const stationary = orbiter.querySelector(`#orbit${orbitNumber}-orbiter${orbiterNumber}-stationary`).checked ? 'stationary' : '';
            return `<div class="orbiter ${shape} ${size} ${alignment} ${stationary}">${orbiterNumber}</div>\n`;
          }).join('');
          return `
    <div class="orbit ${sector ? `sector-${sector}` : ``} ${offset ? `offset-${offset}` : ``} ${ccw}  ${visible}">
      ${orbiters}
    </div>
          `;
        }).join('');
        const orbitsContainer = document.querySelector('.docker');
        orbitsContainer.innerHTML = html;
        document.querySelector('#code').innerHTML = html;
      }; 
      const formChangeHandler = () => {
        updateDOM();
      };
      form.addEventListener('change', formChangeHandler);
      addorbitButton.addEventListener('click', addorbitButtonHandler);
      const addorbiterButtons = document.querySelectorAll('.add-orbiter-button');
      addorbiterButtons.forEach((addorbiterButton) => {
        addorbiterButton.addEventListener('click', addorbiterButtonHandler);
      });
      
      
</script>
